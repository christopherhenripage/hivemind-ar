<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Support - HiveMind AR</title>
  <link rel="stylesheet" href="/styles/hivemind.css">
  <style>
    .mobile-menu-btn { display: none; position: fixed; top: 1rem; left: 1rem; z-index: 101; background: var(--hm-dark); color: white; border: none; width: 40px; height: 40px; border-radius: 8px; font-size: 1.25rem; cursor: pointer; }
    @media (max-width: 768px) {
      .mobile-menu-btn { display: block; }
      .breadcrumb, .page-header { padding-left: 4rem; }
    }

    .support-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
    @media (max-width: 900px) { .support-grid { grid-template-columns: 1fr; } }

    .support-card { background: white; border-radius: 12px; padding: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    .support-card h2 { margin: 0 0 1rem 0; font-size: 1.25rem; display: flex; align-items: center; gap: 0.5rem; }
    .support-card p { color: var(--hm-text-muted); margin-bottom: 1.5rem; font-size: 0.9rem; }

    .contact-form .form-group { margin-bottom: 1rem; }
    .contact-form label { display: block; margin-bottom: 0.5rem; font-weight: 500; font-size: 0.9rem; }
    .contact-form input, .contact-form textarea, .contact-form select { width: 100%; padding: 0.75rem; border: 1px solid var(--hm-border); border-radius: 8px; font-size: 0.9rem; font-family: inherit; }
    .contact-form textarea { resize: vertical; min-height: 120px; }

    .faq-list { margin-top: 1rem; }
    .faq-item { border-bottom: 1px solid var(--hm-border); }
    .faq-item:last-child { border-bottom: none; }
    .faq-question { padding: 1rem 0; cursor: pointer; font-weight: 500; display: flex; justify-content: space-between; align-items: center; }
    .faq-question:hover { color: #667eea; }
    .faq-answer { padding: 0 0 1rem 0; color: var(--hm-text-muted); font-size: 0.9rem; line-height: 1.6; display: none; }
    .faq-item.open .faq-answer { display: block; }
    .faq-item.open .faq-toggle { transform: rotate(180deg); }
    .faq-toggle { transition: transform 0.2s; }

    .quick-links { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem; }
    .quick-link { display: flex; align-items: center; gap: 0.75rem; padding: 1rem; background: var(--hm-light-gray); border-radius: 8px; text-decoration: none; color: var(--hm-text); transition: all 0.2s; }
    .quick-link:hover { background: #e2e8f0; }
    .quick-link-icon { font-size: 1.5rem; }
    .quick-link-text { font-size: 0.875rem; }

    .success-message { background: #dcfce7; color: #166534; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; display: none; }
    .error-message { background: #fee2e2; color: #dc2626; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; display: none; }
  </style>
</head>
<body>
  <div class="mobile-overlay" id="mobileOverlay" onclick="closeSidebar()"></div>

  <div class="dashboard-layout">
    <aside class="sidebar" id="sidebar">
      <a href="/" class="sidebar-header" style="text-decoration: none; color: inherit;">
        <img src="https://media.hivemindar.com/images/common/mini_hivemind_logo_white.png" alt="HiveMind" class="logo-icon" style="height: 32px;">
        <span class="logo-text">HiveMind AR</span>
      </a>
      <nav class="sidebar-nav">
        <a href="/pages/subscriber/dashboard.html"><span class="nav-icon">üìä</span><span class="nav-text">Dashboard</span></a>
        <a href="/pages/subscriber/images.html"><span class="nav-icon">üñºÔ∏è</span><span class="nav-text">My Artworks</span></a>
        <a href="/pages/subscriber/analytics.html"><span class="nav-icon">üìà</span><span class="nav-text">Analytics</span></a>
        <a href="/pages/subscriber/profile.html"><span class="nav-icon">üë§</span><span class="nav-text">Profile</span></a>
        <a href="/pages/subscriber/messages.html"><span class="nav-icon">‚úâÔ∏è</span><span class="nav-text">Messages</span></a>
        <a href="/pages/subscriber/upgrade.html"><span class="nav-icon">‚≠ê</span><span class="nav-text">Upgrade Plan</span></a>
        <a href="/pages/subscriber/support.html" class="active"><span class="nav-icon">üéß</span><span class="nav-text">Support</span></a>
      </nav>
      <div class="sidebar-footer">
        <a href="#" onclick="handleLogout()"><span class="nav-icon">üö™</span><span class="nav-text">Sign Out</span></a>
      </div>
    </aside>

    <main class="main-content">
      <button class="mobile-menu-btn" onclick="toggleSidebar()">‚ò∞</button>

      <div class="breadcrumb">
        <a href="/pages/subscriber/dashboard.html">Dashboard</a> / <span>Support</span>
      </div>

      <div class="page-header">
        <h1>Help & Support</h1>
      </div>

      <div class="page-content">
        <div class="support-grid">
          <!-- Contact Form -->
          <div class="support-card">
            <h2>üìß Contact Us</h2>
            <p>Have a question or need help? Send us a message and we'll get back to you within 24 hours.</p>

            <div class="success-message" id="successMessage">Your message has been sent! We'll get back to you soon.</div>
            <div class="error-message" id="errorMessage">Failed to send message. Please try again.</div>

            <form class="contact-form" id="supportForm" onsubmit="handleSubmit(event)">
              <div class="form-group">
                <label for="subject">Subject</label>
                <select id="subject" required>
                  <option value="">Select a topic...</option>
                  <option value="general">General Question</option>
                  <option value="technical">Technical Issue</option>
                  <option value="billing">Billing & Subscription</option>
                  <option value="ar">AR Viewing Issue</option>
                  <option value="feature">Feature Request</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label for="message">Message</label>
                <textarea id="message" required placeholder="Describe your question or issue..."></textarea>
              </div>
              <button type="submit" class="btn btn-dark" id="submitBtn">Send Message</button>
            </form>
          </div>

          <!-- FAQ -->
          <div class="support-card">
            <h2>‚ùì Frequently Asked Questions</h2>
            <p>Find quick answers to common questions.</p>

            <div class="faq-list">
              <div class="faq-item" onclick="toggleFaq(this)">
                <div class="faq-question">
                  How do I upload artwork?
                  <span class="faq-toggle">‚ñº</span>
                </div>
                <div class="faq-answer">
                  Go to "My Artworks" in the sidebar, then click "Add New Artwork". Fill in the details, dimensions, and upload your image. The AR model will be generated automatically.
                </div>
              </div>

              <div class="faq-item" onclick="toggleFaq(this)">
                <div class="faq-question">
                  How does AR viewing work?
                  <span class="faq-toggle">‚ñº</span>
                </div>
                <div class="faq-answer">
                  When you upload artwork with dimensions, we automatically create a 3D model. Collectors can view your artwork in AR by clicking "View in AR" on your gallery page. They'll see the artwork at true scale on their walls.
                </div>
              </div>

              <div class="faq-item" onclick="toggleFaq(this)">
                <div class="faq-question">
                  How do I share my gallery?
                  <span class="faq-toggle">‚ñº</span>
                </div>
                <div class="faq-answer">
                  Your gallery link is shown on your Dashboard and Profile page. Copy this link and share it with potential collectors via email, social media, or your website.
                </div>
              </div>

              <div class="faq-item" onclick="toggleFaq(this)">
                <div class="faq-question">
                  How do I upgrade my plan?
                  <span class="faq-toggle">‚ñº</span>
                </div>
                <div class="faq-answer">
                  Go to "Upgrade Plan" in the sidebar to see available plans. Click on the plan you want and follow the payment process. Your new limits take effect immediately.
                </div>
              </div>

              <div class="faq-item" onclick="toggleFaq(this)">
                <div class="faq-question">
                  Can I cancel my subscription?
                  <span class="faq-toggle">‚ñº</span>
                </div>
                <div class="faq-answer">
                  Yes, you can cancel anytime. Go to the Upgrade page and click "Downgrade to Free". Your current benefits continue until the end of your billing period.
                </div>
              </div>

              <div class="faq-item" onclick="toggleFaq(this)">
                <div class="faq-question">
                  What happens when I reach my artwork limit?
                  <span class="faq-toggle">‚ñº</span>
                </div>
                <div class="faq-answer">
                  You won't be able to add new artworks until you upgrade your plan or delete existing ones. Your existing artworks remain visible to collectors.
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Links -->
        <div class="support-card" style="margin-top: 2rem;">
          <h2>üîó Quick Links</h2>
          <div class="quick-links">
            <a href="/pages/subscriber/images.html?action=create" class="quick-link">
              <span class="quick-link-icon">üñºÔ∏è</span>
              <span class="quick-link-text">Add New Artwork</span>
            </a>
            <a href="/pages/subscriber/profile.html" class="quick-link">
              <span class="quick-link-icon">üë§</span>
              <span class="quick-link-text">Edit Profile</span>
            </a>
            <a href="/pages/subscriber/upgrade.html" class="quick-link">
              <span class="quick-link-icon">‚≠ê</span>
              <span class="quick-link-text">Upgrade Plan</span>
            </a>
            <a href="/pages/subscriber/messages.html" class="quick-link">
              <span class="quick-link-icon">‚úâÔ∏è</span>
              <span class="quick-link-text">View Messages</span>
            </a>
          </div>
        </div>
      </div>

      <footer class="dashboard-footer">&copy; 2026 HiveMind AR</footer>
    </main>
  </div>

  <script type="module">
    import { supabase } from '/src/supabase.js';

    let currentUser = null;

    async function checkAuth() {
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) { window.location.href = '/pages/auth/login.html'; return null; }
      return user;
    }

    window.toggleFaq = function(item) {
      item.classList.toggle('open');
    };

    window.handleSubmit = async function(event) {
      event.preventDefault();

      const subject = document.getElementById('subject').value;
      const message = document.getElementById('message').value;
      const submitBtn = document.getElementById('submitBtn');
      const successEl = document.getElementById('successMessage');
      const errorEl = document.getElementById('errorMessage');

      successEl.style.display = 'none';
      errorEl.style.display = 'none';
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending...';

      try {
        // Get user profile for email
        const { data: profile } = await supabase
          .from('profiles')
          .select('full_name, email')
          .eq('id', currentUser.id)
          .single();

        // Map subject to category
        const categoryMap = {
          'general': 'general',
          'technical': 'technical',
          'billing': 'billing',
          'ar': 'technical',
          'feature': 'feature_request',
          'other': 'general'
        };

        // Insert support ticket
        const { error } = await supabase
          .from('support_tickets')
          .insert({
            user_id: currentUser.id,
            subject: `Support Request: ${subject}`,
            category: categoryMap[subject] || 'general',
            message: message,
            contact_email: profile?.email || currentUser.email,
            contact_name: profile?.full_name || 'User',
            status: 'open',
            priority: 'normal'
          });

        if (error) throw error;

        successEl.style.display = 'block';
        document.getElementById('supportForm').reset();

      } catch (err) {
        console.error('Error submitting support ticket:', err);
        errorEl.style.display = 'block';
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Send Message';
      }
    };

    window.handleLogout = async function() { await supabase.auth.signOut(); window.location.href = '/pages/auth/login.html'; };
    window.toggleSidebar = function() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('mobileOverlay').classList.toggle('active'); };
    window.closeSidebar = function() { document.getElementById('sidebar').classList.remove('open'); document.getElementById('mobileOverlay').classList.remove('active'); };

    async function init() {
      currentUser = await checkAuth();
    }
    init();
  </script>
</body>
</html>
